# Smart Tourist Safety & Incident Response System

## Enhanced Logging System

This project now includes an enhanced logging system that provides detailed information about API requests, responses, and data changes. The logs are stored in the `logs` directory and are also displayed in the console.

## Setting Up the Logging System

Before running the application, set up the logging directories:

```bash
python setup_logs.py
```

This script will create the following log files:
- `logs/api.log`: General API activity logs
- `logs/data_changes.log`: Data modification events (create, update, delete)
- `logs/errors.log`: Error logs

## Running the Application with Enhanced Logging

Use the provided run script to start the application with proper logging configuration:

```bash
python run.py
```

Additional options:
```
usage: run.py [-h] [--host HOST] [--port PORT] [--reload] [--log-level LOG_LEVEL]

Run the Smart Tourist Safety API with enhanced logging

options:
  -h, --help           show this help message and exit
  --host HOST          Host to bind the server to
  --port PORT          Port to bind the server to
  --reload             Enable auto-reload on code changes
  --log-level LOG_LEVEL  Logging level (debug, info, warning, error, critical)
```

## Log Categories

The logging system categorizes events into different types:

1. **API Request/Response Logs**:
   - Logs all API requests with method, path, query parameters
   - Logs response status code and time taken
   - Each request is assigned a unique Request ID for tracking

2. **Data Change Logs**:
   - Tracks create, update, and delete operations
   - Records the entity type, ID, and operation
   - Masks sensitive data for security

3. **Critical Event Logs**:
   - SOS alerts: Logs when a tourist presses the SOS button
   - Geofence alerts: Logs when tourists enter restricted zones
   - AI safety assessments: Logs safety scores and risk factors

4. **System Event Logs**:
   - Application startup and shutdown
   - Service initialization
   - Database connectivity

## Log Format

All logs follow this format:
```
TIMESTAMP - MODULE - LEVEL - MESSAGE
```

Example:
```
2025-09-28 12:15:30 - data_changes - WARNING - [1632984530-1234] ⚠️ GEOFENCE ALERT - Tourist 23 entered restricted zone 'High Risk Area' at coordinates (28.6139, 77.2090)
```

## Viewing Logs

You can view logs in real-time using:

```bash
# View all logs
tail -f logs/api.log

# View only data change logs
tail -f logs/data_changes.log

# View error logs
tail -f logs/errors.log
```

## API Endpoints That Log Data Changes

The following endpoints log detailed changes:

1. **Tourist Management**:
   - `POST /registerTourist` - New tourist registration
   - `PUT /tourists/{tourist_id}` - Tourist profile updates
   - `DELETE /tourists/{tourist_id}` - Tourist account deletion

2. **Alert Management**:
   - `POST /pressSOS` - Emergency SOS alerts
   - `POST /alerts/geofence` - Geofence violation alerts
   - `PUT /alerts/{alert_id}/acknowledge` - Alert acknowledgments
   - `PUT /alerts/{alert_id}/resolve` - Alert resolutions

3. **Location Updates**:
   - `POST /sendLocation` - Tourist location updates

4. **AI Assessments**:
   - AI safety score calculations and risk assessments